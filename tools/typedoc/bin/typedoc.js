#!/usr/bin/env node
import { promises as fs } from "node:fs";
import path from "node:path";

async function loadConfig() {
  const configPath = path.resolve(process.cwd(), "typedoc.json");
  try {
    const raw = await fs.readFile(configPath, "utf8");
    return JSON.parse(raw);
  } catch {
    return {};
  }
}

async function main() {
  const config = await loadConfig();
  const outDir = path.resolve(process.cwd(), config.out ?? "docs");
  await fs.mkdir(outDir, { recursive: true });

  const readmePath = path.resolve(process.cwd(), config.readme ?? "README.md");
  const outputPath = path.join(outDir, "index.md");

  let content = "# Documentation\n\nGenerated by local Typedoc placeholder.";
  try {
    content = await fs.readFile(readmePath, "utf8");
  } catch {
    // keep default content
  }

  await fs.writeFile(outputPath, content);
  console.log(`Docs generated at ${outDir}`);
}

main().catch((error) => {
  console.error("Failed to generate docs:", error);
  process.exit(1);
});
